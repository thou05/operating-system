## Câu 1

![[bai-tap-2-lenh-shell1.png]]

## Câu 2

![[bai-tap-2-lenh-shell2.1.png]]
## Câu 3
###### `~/.bash_profile`

![[bai-tap-2-lenh-shell3.1.png]]

| Lệnh                                             | Giải thich                                                                                   |
| ------------------------------------------------ | -------------------------------------------------------------------------------------------- |
| if \[ -f ~/.bashrc ]; then<br>	. ~/.bashrc<br>fi | Nạp `.bashrc` nếu có, giúp kế thừa alias và cấu hình shell<br><br>                           |
| PATH=\$PATH:\$HOME/.local/bin:$HOME/bin          | Thêm thư mục cá nhân vào biến `PATH`, giúp chạy lệnh trong `~/bin` mà không cần gõ đường dẫn |
| export PATH                                      | Xuất `PATH` thành biến môi trường, để shell con cũng sử dụng được                            |


###### `~/.bashrc`

![[bai-tap-2-lenh-shell3.2.png]]

| Lệnh                                                 | Giải thich                                                                                                 |
| ---------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| if \[ -f /etc/bashrc ]; then<br>	. /etc/bashrc<br>fi | Nạp `/etc/bashrc` nếu có, để kế thừa cấu hình hệ thống<br><br>                                             |
| # export SYSTEMD_PAGER=                              | Dòng này bị comment (`#`), nếu bỏ comment, nó sẽ vô hiệu hóa tính năng tự động phân trang của `systemctl`. |
| # User specific aliases and functions                | Bên dưới là nơi có thể thêm alias và hàm tùy chỉnh cho shell.                                              |
###### `~/.bash_logout`

![[bai-tap-2-lenh-shell3.3.png]]

- `~/.bash_logout` chạy khi thoát shell login.
- Thường dùng để dọn dẹp terminal hoặc ghi log.

###### `/etc/profile`

| Lệnh                                                                                                                                                                                                                                                                              | Giải thich                                                                                                                                                                                                                                                                                                                                                 |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| pathmunge () {<br>    case ":\${PATH}:" in<br>        \*:"\$1":\*)<br>            ;;<br>        \*)<br>            if \[ "\$2" = "after" ] ; then<br>                PATH=\$PATH:\$1<br>            else<br>                PATH=\$1:$PATH<br>            fi<br>    esac<br>}<br> | Nạp `.bashrc` nếu có, giúp kế thừa alias và cấu hình shell<br><br>Nếu `$1` chưa có trong `PATH`, nó sẽ được thêm vào.<br>Nếu `$2` = `"after"`, `$1` sẽ được thêm vào cuối `PATH`, ngược lại nó sẽ được thêm vào đầu.<br>                                                                                                                                   |
|                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                            |
| if \[ -x /usr/bin/id ]; then<br>    if \[ -z "\$EUID" ]; then<br>        # ksh workaround<br>        EUID=/usr/bin/id -u<br>        UID=/usr/bin/id -ru<br>    fi<br>    USER="/usr/bin/id -un"<br>    LOGNAME=\$USER<br>    MAIL="/var/spool/mail/$USER"<br>fi<br>               | Lệnh `/usr/bin/id` kiểm tra thông tin user.<br>`EUID` (Effective User ID) và `UID` được lấy từ lệnh `id -u`.<br>`USER` và `LOGNAME` là tên đăng nhập của user hiện tại.<br>`MAIL` chứa đường dẫn đến hộp thư của user trong `/var/spool/mail/`                                                                                                             |
|                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                            |
| if \[ "$EUID" = "0" ]; then<br>    pathmunge /usr/sbin<br>    pathmunge /usr/local/sbin<br>else<br>    pathmunge /usr/local/sbin after<br>    pathmunge /usr/sbin after<br>fi<br>                                                                                                 | Nếu user là root (`EUID=0`), `/usr/sbin` và `/usr/local/sbin` được thêm vào đầu `PATH`.<br>Nếu user không phải root, các thư mục này được thêm vào cuối `PATH`.                                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                            |
| HOSTNAME=/usr/bin/hostname 2>/dev/null<br>HISTSIZE=1000<br>if \[ "\$HISTCONTROL" = "ignorespace" ] ; then<br>    export HISTCONTROL=ignoreboth<br>else<br>    export HISTCONTROL=ignoredups<br>fi<br><br>export PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL<br>          | Cấu hình lịch sử lệnh<br>- `HOSTNAME`: Lấy tên máy chủ.<br>- `HISTSIZE=1000`: Giới hạn lưu tối đa 1000 dòng lịch sử lệnh.<br>- `HISTCONTROL`:<br>    - **ignoreboth**: Bỏ qua lệnh trùng lặp và lệnh có dấu cách đầu dòng.<br>    - **ignoredups**: Chỉ bỏ qua lệnh trùng lặp liên tiếp.<br>- `export` để các biến này có thể sử dụng trong các shell con. |
|                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                            |
| if \[ \$UID -gt 199 ] && \[ "/usr/bin/id -gn" = "/usr/bin/id -un" ]; then<br>    umask 002<br>else<br>    umask 022<br>fi<br>                                                                                                                                                     | Thiết lập quyền mặc định<br>- `umask` kiểm soát quyền mặc định của file mới tạo.<br>- Nếu user có UID > 199 (tức là user thông thường) và nhóm chính trùng với tên user:<br>    - `umask 002` → Cho phép nhóm (`group`) chỉnh sửa file.<br>- Nếu không:<br>    - `umask 022` → Chỉ chủ sở hữu (`owner`) có quyền chỉnh sửa file.                           |
|                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                            |
| for i in /etc/profile.d/.sh /etc/profile.d/sh.local ; do<br>    if \[ -r "\$i" ]; then<br>        if [ "\${-#\*i}" != "\$-" ]; then <br>            . "\$i"<br>        else<br>            . "\$i" >/dev/null<br>        fi<br>    fi<br>done<br>                                 | Load tất cả script trong `/etc/profile.d/`<br><br>Vòng lặp nạp tất cả script trong `/etc/profile.d/`.<br>                                                                                                                                                                                                                                                  |
| unset i<br>unset -f pathmunge                                                                                                                                                                                                                                                     | Xóa biến i và hàm pathmunge                                                                                                                                                                                                                                                                                                                                |

###### `/etc/bashrc`

| Lệnh                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Giải thich                                                                                                                                                                                                                                                                                                                                                                                           |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| if \[ "\$PS1" ]; then<br>                                                                                                                                                                                                                                                                                                                                                                                                                                               | Nhận diện shell có phải là interactive không<br>`$PS1` là biến lưu prompt của Bash, nếu có giá trị, nghĩa là đây là một shell tương tác.<br>                                                                                                                                                                                                                                                         |
| if \[ -z "\$PROMPT_COMMAND" ]; then<br>    case \$TERM in<br>    xterm\*\|vte*)<br>      if \[ -e /etc/sysconfig/bash-prompt-xterm ]; then<br>          PROMPT_COMMAND=/etc/sysconfig/bash-prompt-xterm<br>      elif \[ "\${VTE_VERSION:-0}" -ge 3405 ]; then<br>          PROMPT_COMMAND="\_\_vte_prompt_command"<br>      else<br>          PROMPT_COMMAND='printf "\033]0;%s@%s:%s\007" "\${USER}" "\${HOSTNAME\%%.\*}" "\${PWD/#$HOME/~}"'<br>      fi<br>      ;; | Cấu hình `PROMPT_COMMAND` dựa trên loại terminal<br><br>Nếu `PROMPT_COMMAND` chưa được thiết lập, nó sẽ được cấu hình dựa trên giá trị của biến `TERM`:<br><br>- Với `xterm*`, `vte*`: đặt tiêu đề cửa sổ terminal với tên người dùng, hostname và thư mục hiện tại.<br>- Với `screen*`: dùng định dạng khác để đặt tiêu đề.<br>- Nếu có file `/etc/sysconfig/bash-prompt-xterm`, nó sẽ được sử dụng |
| shopt -s histappend<br>history -a                                                                                                                                                                                                                                                                                                                                                                                                                                       | Cấu hình lịch sử lệnh<br>- `shopt -s histappend`: Cho phép ghi lịch sử lệnh vào file `.bash_history` mà không ghi đè dữ liệu cũ.<br>- `history -a`: Ghi ngay lệnh vừa nhập vào file lịch sử.                                                                                                                                                                                                         |
| shopt -s checkwinsize                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Cập nhật kích thước terminal mỗi khi cửa sổ thay đổi.                                                                                                                                                                                                                                                                                                                                                |
| \[ "\$PS1" = "\\\s-\\\v\\\\\\$ " ] && PS1="\[\u@\h \W]\\\\$ "                                                                                                                                                                                                                                                                                                                                                                                                           | Nếu giá trị mặc định của `PS1` là `\s-\v\$` , thì đặt lại thành `[username@hostname current_directory]$`                                                                                                                                                                                                                                                                                             |
| if ! shopt -q login_shell ; then # We're not a login shell                                                                                                                                                                                                                                                                                                                                                                                                              | Nếu đây không phải là login shell, các cài đặt sau sẽ được thực thi.                                                                                                                                                                                                                                                                                                                                 |
| pathmunge () {<br>    case ":\${PATH}:" in<br>        \*:"\$1":\*)<br>            ;;<br>        \*)<br>            if \[ "\$2" = "after" ] ; then<br>                PATH=\$PATH:\$1<br>            else<br>                PATH=\$1:$PATH<br>            fi<br>    esac<br>}                                                                                                                                                                                           | - Hàm `pathmunge` dùng để thêm đường dẫn vào biến `PATH` một cách có kiểm soát.<br>- Tránh thêm trùng lặp đường dẫn.                                                                                                                                                                                                                                                                                 |
| if \[ \$UID -gt 199 ] && \[ "/usr/bin/id -gn" = "/usr/bin/id -un" ]; then<br>       umask 002<br>    else<br>       umask 022<br>    fi                                                                                                                                                                                                                                                                                                                                 | Nếu UID của người dùng > 199 và nhóm chính của người dùng trùng với tên người dùng: Đặt `umask` thành `002` (cho phép group ghi).<br><br>Ngược lại: Đặt `umask` thành `022` (chỉ cho phép user ghi).                                                                                                                                                                                                 |
| SHELL=/bin/bash<br>    for i in /etc/profile.d/\*.sh; do<br>        if \[ -r "\$i" ]; then<br>            if \[ "\$PS1" ]; then<br>                . "\$i"<br>            else<br>                . "\$i" >/dev/null<br>            fi<br>        fi<br>    done                                                                                                                                                                                                        | Nếu là shell tương tác (`$PS1` tồn tại), thực thi các script trong `/etc/profile.d/`.<br><br>Nếu không phải interactive shell, chỉ chạy các script mà không hiển thị đầu ra.                                                                                                                                                                                                                         |
| unset i<br>    unset -f pathmunge                                                                                                                                                                                                                                                                                                                                                                                                                                       | Xóa biến `i` và hàm `pathmunge` sau khi dùng xong.                                                                                                                                                                                                                                                                                                                                                   |

## Câu 4
![[bai-tap-2-lenh-shell4.1.png]]

![[bai-tap-2-lenh-shell4.2.png]]

![[bai-tap-2-lenh-shell4.3.png]]